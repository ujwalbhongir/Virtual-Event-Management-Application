pipeline {
    agent any

    tools {
        maven "maven3"
        jdk "jdk17"
    }

    environment {
        TOMCAT_USER = "admin"
        TOMCAT_PASS = "admin"
        TOMCAT_URL  = "http://localhost:8080/manager/text"
        APP_NAME    = "virtual-event-app"
    }

    stages {

        stage('Checkout') {
            steps {
                git url: 'https://github.com/ujwalbhongir/Virtual-Event-Management-Application.git'
            }
        }

        stage('Build with Maven') {
            steps {
                sh 'mvn clean package'
            }
        }

        stage('Deploy to Tomcat') {
            steps {
                script {
                    def warFile = "target/*.war"

                    sh """
                    curl -u $TOMCAT_USER:$TOMCAT_PASS \
                        --upload-file ${warFile} \
                        "$TOMCAT_URL/deploy?path=/${APP_NAME}&update=true"
                    """
                }
            }
        }
    }

    post {
        success {
            echo "Deployment Successful!"
            echo "App URL: http://localhost:8080/${APP_NAME}/"
        }
    }
}
